L.Spike=L.Class.extend({options:{maxHeight:50,colorFrom:[0,255,0],colorTo:[255,0,0]},initialize:function(t){L.setOptions(this,t)},setMaxValue:function(t){this._maxValue=t},createSpike:function(t){var e=document.createElement("div"),i=4,s=this._getHeight(t);return e.className="leaflet-spike",e.style.width=i+"px",e.style.height=s+"px",e.style.background=this._chooseColor(t),e.style.position="absolute",e.style.marginTop=-s+"px",this._initInteraction(e),this._value=t,e},_getHeight:function(t){return t/this._maxValue*this.options.maxHeight},_getStepColor:function(t){var e=this.options.colorFrom,i=this.options.colorTo;return e.map(function(e,s){return e+t*(i[s]-e)&255})},_chooseColor:function(t){var e=t/this._maxValue,i=this._getStepColor(e>=1?1:e);return"rgb("+i.join()+")"},_initInteraction:function(t){L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.addListener(t,"mouseenter",this._mouseEnter,this),L.DomEvent.addListener(t,"mouseleave",this._mouseLeave,this),L.DomEvent.addListener(t,"mouseover",this._mouseOver,this),L.DomEvent.addListener(t,"mouseout",this._mouseOut,this),L.DomEvent.addListener(t,"click",this._mouseClick,this)},_mouseClick:function(t){this.options.mouseclick&&this.options.mouseclick(t.toElement,this._value)},_mouseEnter:function(t){this.options.mouseenter&&this.options.mouseenter(t.toElement,this._value)},_mouseLeave:function(t){this.options.mouseleave&&this.options.mouseleave(t.fromElement,this._value)},_mouseOver:function(t){t.toElement.style.zIndex=250},_mouseOut:function(t){t.fromElement.style.zIndex=0}}),L.spike=function(t){return new L.Spike(t)},L.SpikeLayer=L.Class.extend({options:{spikeOptions:{}},initialize:function(t,e){L.setOptions(this,e),this._latlng=t},onAdd:function(t){return this._map=t,this._map.on("viewreset",this.update,this),this.update()},onRemove:function(){return this.update()},addLatLng:function(t){return this._latlng.push(t),this.update()},setLatLngs:function(t){return this._latlng=t,this.update()},addTo:function(t){return t.addLayer(this),this},update:function(){var t=0;if(this.options.maxValue)t=this.options.maxValue;else for(var e=this._latlng.length-1;e>=0;e--)this._latlng[e][2]>t&&(t=this._latlng[e][2]);this._resetSpikeLayer();for(var e=this._latlng.length-1;e>=0;e--)this._initSpike(L.latLng(this._latlng[e]),t);return this},_resetSpikeLayer:function(){this._spikesLayer&&this._spikesLayer.remove(),this._spikesLayer=document.createElement("div"),this._spikesLayer.id="spikesLayer",this._spikesLayer.className="leaflet-zoom-hide",this._spikesLayer.style.position="relative",this._map.getPanes().overlayPane.appendChild(this._spikesLayer)},_initSpike:function(t,e){var i=this._map.latLngToLayerPoint(t),s=L.spike(this.options.spikeOptions);s.setMaxValue(e);var n=s.createSpike(t.alt);this._spikesLayer.appendChild(n),L.DomUtil.setPosition(n,i)}}),L.spikeLayer=function(t,e){return new L.SpikeLayer(t,e)};